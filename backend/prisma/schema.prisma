generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")  // Used for migrations with Supabase connection pooling
}

model User {
  id             String         @id @default(uuid()) @db.Uuid
  email          String?        @unique @db.VarChar(255)
  fullName       String?        @map("full_name") @db.VarChar(255)
  phone          String?        @db.VarChar(20)
  googleId       String?        @unique @map("google_id") @db.VarChar(255)
  role           String         @default("customer") @db.VarChar(50)
  avatarUrl      String?        @map("avatar_url")
  createdAt      DateTime       @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt      DateTime       @updatedAt @map("updated_at") @db.Timestamp(6)
  lineId         String?        @unique @map("line_id") @db.VarChar(255)
  profilePicture String?        @map("profile_picture")
  customers      Customer[]
  notifications  Notification[]

  @@index([email])
  @@index([googleId])
  @@index([lineId])
  @@map("users")
}

model Customer {
  id            String         @id @default(uuid()) @db.Uuid
  userId        String?        @map("user_id") @db.Uuid
  airtableId    String?        @unique @map("airtable_id") @db.VarChar(255)
  companyName   String?        @map("company_name") @db.VarChar(255)
  contactPerson String?        @map("contact_person") @db.VarChar(255)
  phone         String?        @db.VarChar(20)
  lineId        String?        @map("line_id") @db.VarChar(255)
  address       String?
  notes         String?
  createdAt     DateTime       @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt     DateTime       @updatedAt @map("updated_at") @db.Timestamp(6)
  discount      Decimal?       @db.Decimal(5, 2)
  tier          String         @default("regular") @db.VarChar(20)
  totalSpent    Decimal?       @default(0) @map("total_spent") @db.Decimal(12, 2)
  vipSince      DateTime?      @map("vip_since") @db.Timestamp(6)
  user          User?          @relation(fields: [userId], references: [id])
  notifications Notification[]
  orders        Order[]
  reviews       Review[]

  @@index([userId])
  @@index([airtableId])
  @@index([tier])
  @@map("customers")
}

model Order {
  id                String          @id @default(uuid()) @db.Uuid
  orderNumber       String          @unique @map("order_number") @db.VarChar(50)
  customerId        String?         @map("customer_id") @db.Uuid
  shippingMethod    String          @map("shipping_method") @db.VarChar(20)
  status            String          @default("pending") @db.VarChar(50)
  origin            String?         @db.VarChar(255)
  destination       String?         @db.VarChar(255)
  totalWeight       Decimal?        @map("total_weight") @db.Decimal(10, 2)
  totalVolume       Decimal?        @map("total_volume") @db.Decimal(10, 2)
  estimatedCost     Decimal?        @map("estimated_cost") @db.Decimal(10, 2)
  actualCost        Decimal?        @map("actual_cost") @db.Decimal(10, 2)
  estimatedDelivery DateTime?       @map("estimated_delivery") @db.Date
  notes             String?
  createdAt         DateTime        @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt         DateTime        @updatedAt @map("updated_at") @db.Timestamp(6)
  orderItems        OrderItem[]
  customer          Customer?       @relation(fields: [customerId], references: [id])
  portfolioItems    PortfolioItem[]
  reviews           Review[]
  shipments         Shipment[]

  @@index([customerId])
  @@index([orderNumber])
  @@index([status])
  @@map("orders")
}

model OrderItem {
  id               String              @id @default(uuid()) @db.Uuid
  orderId          String              @map("order_id") @db.Uuid
  sequenceNumber   Int?                @map("sequence_number")
  clickDate        DateTime?           @map("click_date") @db.Timestamp(6)
  clickChannel     String?             @map("click_channel") @db.VarChar(100)
  clickerName      String?             @map("clicker_name") @db.VarChar(255)
  customerName     String?             @map("customer_name") @db.VarChar(255)
  productCode      String?             @map("product_code") @db.VarChar(100)
  productName      String?             @map("product_name") @db.VarChar(500)
  productUrl       String?             @map("product_url")
  priceYen         Decimal?            @map("price_yen") @db.Decimal(10, 2)
  priceBaht        Decimal?            @map("price_baht") @db.Decimal(10, 2)
  itemStatus       String?             @map("item_status") @db.VarChar(100)
  paymentStatus    String?             @map("payment_status") @db.VarChar(100)
  shippingRound    String?             @map("shipping_round") @db.VarChar(100)
  trackingNumber   String?             @map("tracking_number") @db.VarChar(100)
  storePage        String?             @map("store_page") @db.VarChar(255)
  remarks          String?
  createdAt        DateTime            @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt        DateTime            @updatedAt @map("updated_at") @db.Timestamp(6)
  productImages    Json?               @map("product_images")
  statusStep       Int                 @default(1) @map("status_step")
  trackingNumberJP String?             @map("tracking_number_jp") @db.VarChar(100)
  trackingNumberTH String?             @map("tracking_number_th") @db.VarChar(100)
  shippingCost     Decimal?            @map("shipping_cost") @db.Decimal(10, 2)
  weight           Decimal?            @db.Decimal(10, 2)
  statusHistory    ItemStatusHistory[]
  order            Order               @relation(fields: [orderId], references: [id], onDelete: Cascade)
  payments         Payment[]

  @@index([orderId])
  @@index([productCode])
  @@index([trackingNumberJP])
  @@index([trackingNumberTH])
  @@index([trackingNumber])
  @@index([statusStep])
  @@map("order_items")
}

model Shipment {
  id              String            @id @default(uuid()) @db.Uuid
  orderId         String?           @map("order_id") @db.Uuid
  trackingNumber  String            @unique @map("tracking_number") @db.VarChar(100)
  carrier         String?           @db.VarChar(255)
  vesselName      String?           @map("vessel_name") @db.VarChar(255)
  flightNumber    String?           @map("flight_number") @db.VarChar(50)
  departurePort   String?           @map("departure_port") @db.VarChar(255)
  arrivalPort     String?           @map("arrival_port") @db.VarChar(255)
  departureDate   DateTime?         @map("departure_date") @db.Date
  arrivalDate     DateTime?         @map("arrival_date") @db.Date
  currentStatus   String?           @map("current_status") @db.VarChar(100)
  currentLocation String?           @map("current_location") @db.VarChar(255)
  latitude        Decimal?          @db.Decimal(10, 8)
  longitude       Decimal?          @db.Decimal(11, 8)
  createdAt       DateTime          @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt       DateTime          @updatedAt @map("updated_at") @db.Timestamp(6)
  order           Order?            @relation(fields: [orderId], references: [id])
  trackingHistory TrackingHistory[]

  @@index([orderId])
  @@index([trackingNumber])
  @@map("shipments")
}

model TrackingHistory {
  id          String   @id @default(uuid()) @db.Uuid
  shipmentId  String   @map("shipment_id") @db.Uuid
  status      String   @db.VarChar(100)
  location    String?  @db.VarChar(255)
  latitude    Decimal? @db.Decimal(10, 8)
  longitude   Decimal? @db.Decimal(11, 8)
  description String?
  timestamp   DateTime @default(now()) @db.Timestamp(6)
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  shipment    Shipment @relation(fields: [shipmentId], references: [id])

  @@index([shipmentId])
  @@index([timestamp])
  @@map("tracking_history")
}

model Schedule {
  id            String    @id @default(uuid()) @db.Uuid
  scheduleType  String    @map("schedule_type") @db.VarChar(20)
  carrier       String?   @db.VarChar(255)
  vesselName    String?   @map("vessel_name") @db.VarChar(255)
  flightNumber  String?   @map("flight_number") @db.VarChar(50)
  route         String?   @db.VarChar(255)
  departurePort String?   @map("departure_port") @db.VarChar(255)
  arrivalPort   String?   @map("arrival_port") @db.VarChar(255)
  departureDate DateTime? @map("departure_date") @db.Date
  arrivalDate   DateTime? @map("arrival_date") @db.Date
  frequency     String?   @db.VarChar(50)
  status        String    @default("active") @db.VarChar(50)
  notes         String?
  createdAt     DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt     DateTime  @updatedAt @map("updated_at") @db.Timestamp(6)

  @@map("schedules")
}

model Review {
  id            String    @id @default(uuid()) @db.Uuid
  customerId    String?   @map("customer_id") @db.Uuid
  orderId       String?   @map("order_id") @db.Uuid
  rating        Int
  comment       String?
  isApproved    Boolean   @default(false) @map("is_approved")
  isFeatured    Boolean   @default(false) @map("is_featured")
  createdAt     DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt     DateTime  @updatedAt @map("updated_at") @db.Timestamp(6)
  customerImage String?   @map("customer_image")
  customerName  String?   @map("customer_name") @db.VarChar(255)
  customer      Customer? @relation(fields: [customerId], references: [id])
  order         Order?    @relation(fields: [orderId], references: [id])

  @@index([customerId])
  @@index([isApproved])
  @@map("reviews")
}

model PortfolioItem {
  id           String   @id @default(uuid()) @db.Uuid
  title        String   @db.VarChar(255)
  description  String?
  imageUrl     String?  @map("image_url")
  category     String?  @db.VarChar(100)
  orderId      String?  @map("order_id") @db.Uuid
  isFeatured   Boolean  @default(false) @map("is_featured")
  displayOrder Int?     @map("display_order")
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt    DateTime @updatedAt @map("updated_at") @db.Timestamp(6)
  order        Order?   @relation(fields: [orderId], references: [id])

  @@map("portfolio_items")
}

model RateCalculator {
  id             String   @id @default(uuid()) @db.Uuid
  shippingMethod String   @map("shipping_method") @db.VarChar(20)
  origin         String?  @db.VarChar(255)
  destination    String?  @db.VarChar(255)
  weightMin      Decimal? @map("weight_min") @db.Decimal(10, 2)
  weightMax      Decimal? @map("weight_max") @db.Decimal(10, 2)
  ratePerKg      Decimal? @map("rate_per_kg") @db.Decimal(10, 2)
  baseFee        Decimal? @map("base_fee") @db.Decimal(10, 2)
  isActive       Boolean  @default(true) @map("is_active")
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt      DateTime @updatedAt @map("updated_at") @db.Timestamp(6)

  @@map("rate_calculator")
}

model Notification {
  id           String    @id @default(uuid()) @db.Uuid
  userId       String?   @map("user_id") @db.Uuid
  customerId   String?   @map("customer_id") @db.Uuid
  type         String?   @db.VarChar(50)
  subject      String?   @db.VarChar(255)
  message      String?
  status       String    @default("pending") @db.VarChar(50)
  sentAt       DateTime? @map("sent_at") @db.Timestamp(6)
  errorMessage String?   @map("error_message")
  createdAt    DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  customer     Customer? @relation(fields: [customerId], references: [id])
  user         User?     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([status])
  @@map("notifications")
}

model ContactMessage {
  id        String    @id @default(uuid()) @db.Uuid
  name      String    @db.VarChar(255)
  email     String    @db.VarChar(255)
  phone     String?   @db.VarChar(20)
  subject   String?   @db.VarChar(255)
  message   String
  status    String    @default("new") @db.VarChar(50)
  repliedAt DateTime? @map("replied_at") @db.Timestamp(6)
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamp(6)

  @@map("contact_messages")
}

model Statistic {
  id        String   @id @default(uuid()) @db.Uuid
  statType  String   @map("stat_type") @db.VarChar(100)
  statDate  DateTime @map("stat_date") @db.Date
  value     Decimal? @db.Decimal(10, 2)
  metadata  Json?
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)

  @@unique([statType, statDate])
  @@map("statistics")
}

model SystemSetting {
  id        String   @id @default(uuid()) @db.Uuid
  key       String   @unique @db.VarChar(255)
  value     Json
  category  String?  @db.VarChar(100)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamp(6)

  @@index([category])
  @@map("system_settings")
}

model ItemStatusHistory {
  id          String    @id @default(uuid()) @db.Uuid
  orderItemId String    @map("order_item_id") @db.Uuid
  statusStep  Int       @map("status_step")
  statusName  String    @map("status_name") @db.VarChar(100)
  description String?
  changedBy   String?   @map("changed_by") @db.VarChar(255)
  timestamp   DateTime  @default(now()) @db.Timestamp(6)
  orderItem   OrderItem @relation(fields: [orderItemId], references: [id], onDelete: Cascade)

  @@index([orderItemId])
  @@index([statusStep])
  @@index([timestamp])
  @@map("item_status_history")
}

model Payment {
  id                String    @id @default(uuid()) @db.Uuid
  orderItemId       String    @map("order_item_id") @db.Uuid
  installmentNumber Int       @map("installment_number")
  installmentName   String?   @map("installment_name") @db.VarChar(100)
  amountYen         Decimal?  @map("amount_yen") @db.Decimal(10, 2)
  amountBaht        Decimal?  @map("amount_baht") @db.Decimal(10, 2)
  exchangeRate      Decimal?  @map("exchange_rate") @db.Decimal(10, 4)
  status            String    @default("pending") @db.VarChar(50)
  paymentMethod     String?   @map("payment_method") @db.VarChar(50)
  proofImageUrl     String?   @map("proof_image_url")
  dueDate           DateTime? @map("due_date") @db.Date
  paidAt            DateTime? @map("paid_at") @db.Timestamp(6)
  notes             String?
  verifiedBy        String?   @map("verified_by") @db.VarChar(255)
  verifiedAt        DateTime? @map("verified_at") @db.Timestamp(6)
  createdAt         DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt         DateTime  @updatedAt @map("updated_at") @db.Timestamp(6)
  orderItem         OrderItem @relation(fields: [orderItemId], references: [id], onDelete: Cascade)

  @@index([orderItemId])
  @@index([status])
  @@index([installmentNumber])
  @@map("payments")
}
